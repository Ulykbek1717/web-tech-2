<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ShopLite — Admin Panel</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/css/style.css" rel="stylesheet">
  <style>
    .api-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .dark-mode .api-section {
      background: #2a2a2a;
    }
    .response-box {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .dark-mode .response-box {
      background: #1a1a1a;
      border-color: #444;
      color: #e0e0e0;
    }
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-success { background: #d4edda; color: #155724; }
    .status-error { background: #f8d7da; color: #721c24; }
  </style>
  
  <script>
    (function() {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">ShopLite Admin</a>
      <div class="ms-auto">
        <a href="index.html" class="btn btn-sm btn-outline-light me-2">Back to Store</a>
        <button id="mode-toggle" class="btn btn-sm btn-outline-light">Dark/Light</button>
      </div>
    </div>
  </nav>

  <main class="py-5">
    <div class="container">
      <h2 class="mb-4">API Management Panel</h2>
      
      <!-- API Health Check -->
      <div class="api-section">
        <h5>API Health Check</h5>
        <button id="check-health" class="btn btn-primary btn-sm mt-2">Check API Status</button>
        <div id="health-response" class="response-box mt-3" style="display:none;"></div>
      </div>

      <!-- Products Management -->
      <div class="api-section">
        <h5>Products Management</h5>
        
        <!-- Get All Products -->
        <div class="mb-4">
          <h6 class="text-secondary">GET All Products</h6>
          <div class="row g-2">
            <div class="col-auto">
              <select id="filter-category" class="form-select form-select-sm">
                <option value="">All Categories</option>
                <option value="electronics">Electronics</option>
                <option value="apparel">Apparel</option>
                <option value="home">Home</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="col-auto">
              <button id="get-products" class="btn btn-success btn-sm">Get Products</button>
            </div>
          </div>
          <div id="products-response" class="response-box mt-3" style="display:none;"></div>
        </div>

        <!-- Create Product -->
        <div class="mb-4">
          <h6 class="text-secondary">POST Create Product</h6>
          <form id="create-product-form" class="row g-2">
            <div class="col-md-6">
              <input type="text" class="form-control form-control-sm" id="product-name" placeholder="Product Name *" required>
            </div>
            <div class="col-md-6">
              <input type="number" class="form-control form-control-sm" id="product-price" placeholder="Price *" step="0.01" required>
            </div>
            <div class="col-12">
              <textarea class="form-control form-control-sm" id="product-description" placeholder="Description *" rows="2" required></textarea>
            </div>
            <div class="col-md-4">
              <select class="form-select form-select-sm" id="product-category" required>
                <option value="">Select Category *</option>
                <option value="electronics">Electronics</option>
                <option value="apparel">Apparel</option>
                <option value="home">Home</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="col-md-4">
              <input type="url" class="form-control form-control-sm" id="product-image" placeholder="Image URL">
            </div>
            <div class="col-md-4">
              <input type="number" class="form-control form-control-sm" id="product-stock" placeholder="Stock" value="10">
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary btn-sm">Create Product</button>
            </div>
          </form>
          <div id="create-response" class="response-box mt-3" style="display:none;"></div>
        </div>

        <!-- Get Single Product -->
        <div class="mb-4">
          <h6 class="text-secondary">GET Single Product by ID</h6>
          <div class="row g-2">
            <div class="col-auto" style="flex: 1;">
              <input type="text" class="form-control form-control-sm" id="get-product-id" placeholder="Product ID (MongoDB ObjectId)">
            </div>
            <div class="col-auto">
              <button id="get-single-product" class="btn btn-info btn-sm">Get Product</button>
            </div>
          </div>
          <div id="single-product-response" class="response-box mt-3" style="display:none;"></div>
        </div>

        <!-- Update Product -->
        <div class="mb-4">
          <h6 class="text-secondary">PUT Update Product</h6>
          <form id="update-product-form" class="row g-2">
            <div class="col-12">
              <input type="text" class="form-control form-control-sm" id="update-product-id" placeholder="Product ID *" required>
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control form-control-sm" id="update-product-name" placeholder="Product Name *" required>
            </div>
            <div class="col-md-6">
              <input type="number" class="form-control form-control-sm" id="update-product-price" placeholder="Price *" step="0.01" required>
            </div>
            <div class="col-12">
              <textarea class="form-control form-control-sm" id="update-product-description" placeholder="Description *" rows="2" required></textarea>
            </div>
            <div class="col-md-6">
              <select class="form-select form-select-sm" id="update-product-category" required>
                <option value="">Select Category *</option>
                <option value="electronics">Electronics</option>
                <option value="apparel">Apparel</option>
                <option value="home">Home</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="col-md-6">
              <input type="number" class="form-control form-control-sm" id="update-product-stock" placeholder="Stock">
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-warning btn-sm">Update Product</button>
            </div>
          </form>
          <div id="update-response" class="response-box mt-3" style="display:none;"></div>
        </div>

        <!-- Delete Product -->
        <div class="mb-4">
          <h6 class="text-secondary">DELETE Product</h6>
          <div class="row g-2">
            <div class="col-auto" style="flex: 1;">
              <input type="text" class="form-control form-control-sm" id="delete-product-id" placeholder="Product ID">
            </div>
            <div class="col-auto">
              <button id="delete-product" class="btn btn-danger btn-sm">Delete Product</button>
            </div>
          </div>
          <div id="delete-response" class="response-box mt-3" style="display:none;"></div>
        </div>
      </div>

      <!-- Reviews Management -->
      <div class="api-section">
        <h5>Reviews Management</h5>
        
        <!-- Get All Reviews -->
        <div class="mb-4">
          <h6 class="text-secondary">GET All Reviews</h6>
          <div class="row g-2">
            <div class="col-auto" style="flex: 1;">
              <input type="text" class="form-control form-control-sm" id="filter-product-id" placeholder="Filter by Product ID (optional)">
            </div>
            <div class="col-auto">
              <button id="get-reviews" class="btn btn-success btn-sm">Get Reviews</button>
            </div>
          </div>
          <div id="reviews-response" class="response-box mt-3" style="display:none;"></div>
        </div>

        <!-- Create Review -->
        <div class="mb-4">
          <h6 class="text-secondary">POST Create Review</h6>
          <form id="create-review-form" class="row g-2">
            <div class="col-md-6">
              <input type="text" class="form-control form-control-sm" id="review-product-id" placeholder="Product ID *" required>
            </div>
            <div class="col-md-6">
              <input type="text" class="form-control form-control-sm" id="review-author" placeholder="Author Name *" required>
            </div>
            <div class="col-md-12">
              <select class="form-select form-select-sm" id="review-rating" required>
                <option value="">Select Rating *</option>
                <option value="5">5 Stars</option>
                <option value="4">4 Stars</option>
                <option value="3">3 Stars</option>
                <option value="2">2 Stars</option>
                <option value="1">1 Star</option>
              </select>
            </div>
            <div class="col-12">
              <textarea class="form-control form-control-sm" id="review-comment" placeholder="Review Comment *" rows="2" required></textarea>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary btn-sm">Create Review</button>
            </div>
          </form>
          <div id="create-review-response" class="response-box mt-3" style="display:none;"></div>
        </div>

        <!-- Delete Review -->
        <div class="mb-4">
          <h6 class="text-secondary">DELETE Review</h6>
          <div class="row g-2">
            <div class="col-auto" style="flex: 1;">
              <input type="text" class="form-control form-control-sm" id="delete-review-id" placeholder="Review ID">
            </div>
            <div class="col-auto">
              <button id="delete-review" class="btn btn-danger btn-sm">Delete Review</button>
            </div>
          </div>
          <div id="delete-review-response" class="response-box mt-3" style="display:none;"></div>
        </div>
      </div>

      <!-- Quick Reference -->
      <div class="api-section">
        <h5>API Quick Reference</h5>
        <div class="table-responsive">
          <table class="table table-sm table-bordered">
            <thead>
              <tr>
                <th>Method</th>
                <th>Endpoint</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr><td class="text-success fw-bold">GET</td><td>/api/products</td><td>Get all products</td></tr>
              <tr><td class="text-info fw-bold">GET</td><td>/api/products/:id</td><td>Get single product</td></tr>
              <tr><td class="text-primary fw-bold">POST</td><td>/api/products</td><td>Create new product</td></tr>
              <tr><td class="text-warning fw-bold">PUT</td><td>/api/products/:id</td><td>Update product</td></tr>
              <tr><td class="text-danger fw-bold">DELETE</td><td>/api/products/:id</td><td>Delete product</td></tr>
              <tr><td class="text-success fw-bold">GET</td><td>/api/reviews</td><td>Get all reviews</td></tr>
              <tr><td class="text-primary fw-bold">POST</td><td>/api/reviews</td><td>Create new review</td></tr>
              <tr><td class="text-danger fw-bold">DELETE</td><td>/api/reviews/:id</td><td>Delete review</td></tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </main>

  <footer class="bg-dark text-white-50 text-center py-3">
    <p class="mb-0">© <span id="site-year"></span> ShopLite Admin Panel</p>
  </footer>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/app.js"></script>
  
  <script>
    const API_BASE = '/api';

    // Helper functions
    function displayResponse(elementId, data, status) {
      const element = document.getElementById(elementId);
      element.style.display = 'block';
      
      const statusClass = status >= 200 && status < 300 ? 'status-success' : 'status-error';
      const statusText = status >= 200 && status < 300 ? 'SUCCESS' : 'ERROR';
      
      element.innerHTML = `
        <div class="mb-2">
          <span class="status-badge ${statusClass}">Status: ${status} ${statusText}</span>
        </div>
        <pre style="margin:0; white-space: pre-wrap;">${JSON.stringify(data, null, 2)}</pre>
      `;
    }

    async function apiRequest(url, options = {}) {
      try {
        const response = await fetch(url, {
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          ...options
        });
        
        const data = await response.json();
        return { data, status: response.status };
      } catch (error) {
        return {
          data: { error: { message: error.message } },
          status: 0
        };
      }
    }

    // Health Check
    document.getElementById('check-health').addEventListener('click', async () => {
      const { data, status } = await apiRequest(`${API_BASE}/health`);
      displayResponse('health-response', data, status);
    });

    // Get All Products
    document.getElementById('get-products').addEventListener('click', async () => {
      const category = document.getElementById('filter-category').value;
      const url = category ? `${API_BASE}/products?category=${category}` : `${API_BASE}/products`;
      const { data, status } = await apiRequest(url);
      displayResponse('products-response', data, status);
    });

    // Create Product
    document.getElementById('create-product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const productData = {
        name: document.getElementById('product-name').value,
        price: parseFloat(document.getElementById('product-price').value),
        description: document.getElementById('product-description').value,
        category: document.getElementById('product-category').value,
        imageUrl: document.getElementById('product-image').value || undefined,
        stock: parseInt(document.getElementById('product-stock').value) || 0
      };
      
      const { data, status } = await apiRequest(`${API_BASE}/products`, {
        method: 'POST',
        body: JSON.stringify(productData)
      });
      
      displayResponse('create-response', data, status);
      
      if (status === 201) {
        e.target.reset();
      }
    });

    // Get Single Product
    document.getElementById('get-single-product').addEventListener('click', async () => {
      const id = document.getElementById('get-product-id').value;
      if (!id) {
        alert('Please enter a product ID');
        return;
      }
      
      const { data, status } = await apiRequest(`${API_BASE}/products/${id}`);
      displayResponse('single-product-response', data, status);
    });

    // Update Product
    document.getElementById('update-product-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('update-product-id').value;
      const productData = {
        name: document.getElementById('update-product-name').value,
        price: parseFloat(document.getElementById('update-product-price').value),
        description: document.getElementById('update-product-description').value,
        category: document.getElementById('update-product-category').value,
        stock: parseInt(document.getElementById('update-product-stock').value) || 0
      };
      
      const { data, status } = await apiRequest(`${API_BASE}/products/${id}`, {
        method: 'PUT',
        body: JSON.stringify(productData)
      });
      
      displayResponse('update-response', data, status);
    });

    // Delete Product
    document.getElementById('delete-product').addEventListener('click', async () => {
      const id = document.getElementById('delete-product-id').value;
      if (!id) {
        alert('Please enter a product ID');
        return;
      }
      
      if (!confirm('Are you sure you want to delete this product?')) {
        return;
      }
      
      const { data, status } = await apiRequest(`${API_BASE}/products/${id}`, {
        method: 'DELETE'
      });
      
      displayResponse('delete-response', data, status);
    });

    // Get All Reviews
    document.getElementById('get-reviews').addEventListener('click', async () => {
      const productId = document.getElementById('filter-product-id').value;
      const url = productId ? `${API_BASE}/reviews?productId=${productId}` : `${API_BASE}/reviews`;
      const { data, status } = await apiRequest(url);
      displayResponse('reviews-response', data, status);
    });

    // Create Review
    document.getElementById('create-review-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const reviewData = {
        productId: document.getElementById('review-product-id').value,
        author: document.getElementById('review-author').value,
        rating: parseInt(document.getElementById('review-rating').value),
        comment: document.getElementById('review-comment').value
      };
      
      const { data, status } = await apiRequest(`${API_BASE}/reviews`, {
        method: 'POST',
        body: JSON.stringify(reviewData)
      });
      
      displayResponse('create-review-response', data, status);
      
      if (status === 201) {
        e.target.reset();
      }
    });

    // Delete Review
    document.getElementById('delete-review').addEventListener('click', async () => {
      const id = document.getElementById('delete-review-id').value;
      if (!id) {
        alert('Please enter a review ID');
        return;
      }
      
      if (!confirm('Are you sure you want to delete this review?')) {
        return;
      }
      
      const { data, status } = await apiRequest(`${API_BASE}/reviews/${id}`, {
        method: 'DELETE'
      });
      
      displayResponse('delete-review-response', data, status);
    });

    // Year display
    document.getElementById('site-year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
